<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="siteTitle">مركز الألعاب - تحميل أحدث الألعاب</title>
    <meta name="description" content="اكتشف وحمل أحدث وأفضل الألعاب للكمبيوتر والموبايل. تحميلات آمنة ومباشرة." data-key="siteDescription">
    <meta name="robots" content="noindex, nofollow">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --dark-blue-bg: #0a192f; --medium-dark-blue: #1c2541; --primary-blue: #61dafb;
            --action-blue: #00aaff; --text-light: #e0fbfc; --text-secondary: #a8b2d1;
            --card-bg: #0f284a; --heading-font: 'Exo 2', sans-serif; --body-font: 'Open Sans', sans-serif;
            --danger-color: #ff4d4f;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--body-font); line-height: 1.6; color: var(--text-light); background-color: var(--dark-blue-bg); }
        .container { width: 90%; max-width: 1300px; margin: 0 auto; padding: 20px 0; }

        .main-header { background-color: rgba(10, 25, 47, 0.85); padding: 10px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px); }
        .header-content { display: flex; justify-content: space-between; align-items: center; width: 90%; max-width: 1300px; margin: 0 auto; flex-wrap: wrap; gap: 15px; }
        .logo { font-family: var(--heading-font); font-size: 1.8em; color: var(--primary-blue); text-decoration: none; white-space: nowrap; }
        .logo i { margin-inline-end: 8px; }
        .header-controls { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .search-bar input[type="search"] { padding: 8px 15px; border-radius: 20px; border: 1px solid var(--medium-dark-blue); background-color: var(--card-bg); color: var(--text-light); min-width: 200px; transition: all 0.3s ease; }
        .search-bar input[type="search"]::placeholder { color: var(--text-secondary); }
        .search-bar input[type="search"]:focus { outline: none; border-color: var(--primary-blue); background-color: var(--dark-blue-bg); }
        .lang-switcher button { background: none; border: 1px solid var(--primary-blue); color: var(--primary-blue); padding: 5px 10px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s, color 0.3s; margin-inline-start: 5px;}
        .lang-switcher button.active { background-color: var(--primary-blue); color: var(--dark-blue-bg); font-weight: bold;}

        .controls-section { background-color: var(--medium-dark-blue); padding: 15px; border-radius: 8px; margin-bottom: 30px; display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; align-items: center;}
        .filter-group, .sort-group { display: flex; flex-wrap: wrap; align-items: center; gap: 10px;}
        .filter-group label, .sort-group label { margin-inline-end: 8px; font-weight: 600; white-space: nowrap;}
        .filter-group select, .sort-group select { background-color: var(--card-bg); color: var(--text-light); border: 1px solid var(--primary-blue); border-radius: 5px; padding: 8px 12px; cursor: pointer; min-width: 150px; }
        .filter-group select:focus, .sort-group select:focus { outline: none; box-shadow: 0 0 5px var(--primary-blue); }

        .games-grid-section h2 { font-family: var(--heading-font); font-size: 2em; color: var(--primary-blue); text-align: center; margin-bottom: 40px; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .game-card { background-color: var(--card-bg); border-radius: 8px; overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; }
        .game-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0, 170, 255, 0.1); }
        .game-thumbnail img { width: 100%; height: 180px; object-fit: cover; display: block; background-color: var(--medium-dark-blue); }
        .game-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .game-info h3 { font-family: var(--heading-font); font-size: 1.3em; color: var(--text-light); margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .game-info p { font-size: 0.9em; color: var(--text-secondary); margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; min-height: calc(1.6 * 0.9em * 3); }
        .game-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 5px;}
        .game-tags span { background-color: var(--medium-dark-blue); color: var(--primary-blue); font-size: 0.75em; padding: 3px 8px; border-radius: 10px; margin-inline-end: 5px; display: inline-block; margin-bottom: 3px;}
        .platform-icons i { font-size: 1.1em; color: var(--text-secondary); margin-inline-start: 6px;}
        .download-button { display: block; background-color: var(--action-blue); color: #ffffff; text-align: center; padding: 10px 15px; border-radius: 5px; text-decoration: none; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; margin-top: auto; cursor: pointer; border: none; }
        .download-button i { margin-inline-end: 8px; }
        .download-button:hover { background-color: #0088cc; transform: scale(1.03); }

        .load-more-container { text-align: center; margin-top: 40px; }
        .load-more-btn { background-color: var(--action-blue); color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; font-weight: 600; transition: background-color 0.3s ease; }
        .load-more-btn:hover { background-color: #0088cc; }
        .load-more-btn:disabled { background-color: var(--text-secondary); cursor: not-allowed; }
        .load-more-btn.hidden { display: none; }

        #timer-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(10, 25, 47, 0.95); z-index: 2000; display: flex; justify-content: center; align-items: center; padding: 20px; opacity: 0; transition: opacity 0.5s ease; }
        #timer-view.visible { opacity: 1; display: flex !important; }
        .download-container { background-color: var(--card-bg); padding: 40px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); text-align: center; max-width: 700px; width: 100%; position: relative; }
        .close-timer-btn { position: absolute; top: 15px; inset-inline-start: 15px; font-size: 1.5em; color: var(--text-secondary); cursor: pointer; transition: color 0.3s ease; background: none; border: none; padding: 0; }
        .close-timer-btn:hover { color: var(--primary-blue); }
        .timer-game-thumbnail { width: 150px; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 20px; border: 2px solid var(--medium-dark-blue); background-color: var(--medium-dark-blue); }
        .timer-game-title { font-family: var(--heading-font); font-size: 2em; color: var(--primary-blue); margin-bottom: 15px; }
        .timer-game-description { color: var(--text-secondary); margin-bottom: 30px; font-size: 1em; max-height: 100px; overflow-y: auto; padding-inline-end: 10px; }
        .timer-game-description::-webkit-scrollbar { width: 5px; } .timer-game-description::-webkit-scrollbar-track { background: var(--medium-dark-blue); border-radius: 10px;} .timer-game-description::-webkit-scrollbar-thumb { background-color: var(--primary-blue); border-radius: 10px; }
        .timer-container { margin-bottom: 25px; } .timer-text { font-size: 1.2em; color: var(--text-secondary); margin-bottom: 15px; } .timer-display { font-family: var(--heading-font); font-size: 4em; color: var(--primary-blue); font-weight: bold; line-height: 1; }
        .status-message { font-size: 1em; color: var(--action-blue); min-height: 1.5em; margin-top: 20px; }
        .download-notice { font-size: 0.85em; color: var(--text-secondary); margin-top: 30px; }
        .download-notice a { color: var(--primary-blue); }
        #real-download-link { display: none; }

        .main-footer { background-color: var(--medium-dark-blue); color: var(--text-secondary); text-align: center; padding: 25px 0; margin-top: 50px; border-top: 3px solid var(--primary-blue); }
        .footer-content p { margin-bottom: 10px; } .footer-content a { color: var(--primary-blue); text-decoration: none; margin: 0 10px; } .footer-content a:hover { text-decoration: underline; }

        @media (max-width: 992px) { .games-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); } .controls-section { flex-direction: column; align-items: stretch; gap: 15px;} .filter-group, .sort-group { justify-content: space-between;} .filter-group select, .sort-group select { flex-grow: 1; } }
        @media (max-width: 768px) { .header-content { flex-direction: column; gap: 10px;} .search-bar input[type="search"] { width: 100%; } .timer-game-title {font-size: 1.5em;} .timer-display {font-size: 3em;} .download-container {padding: 30px 20px;} }
        @media (max-width: 480px) { .games-grid { grid-template-columns: 1fr; } .logo { font-size: 1.5em; } .timer-game-thumbnail {width: 100px; height: 100px;} }

        .loading::after { content: '...'; display: inline-block; animation: dots 1s steps(3, end) infinite; }
        @keyframes dots { 0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);} 40% { color: var(--text-light); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);} 60% { text-shadow: .25em 0 0 var(--text-light), .5em 0 0 rgba(0,0,0,0);} 80%, 100% { text-shadow: .25em 0 0 var(--text-light), .5em 0 0 var(--text-light);}}
    </style>
</head>
<body>

    <header class="main-header">
        <div class="header-content">
            <a href="#" class="logo" data-key="siteLogo"><i class="fas fa-gamepad"></i> مركز الألعاب</a>
            <div class="header-controls">
                 <div class="search-bar">
                    <input type="search" id="search-input" data-key="searchPlaceholder" placeholder="ابحث عن لعبة...">
                 </div>
                 <div class="lang-switcher">
                     <button id="lang-ar" data-lang="ar">العربية</button>
                     <button id="lang-en" data-lang="en">English</button>
                 </div>
            </div>
        </div>
    </header>

    <main>
        <div id="main-view">
            <div class="container">
                <section class="controls-section">
                    <div class="filter-group">
                        <label for="category-filter" data-key="filterCategoryLabel">الفئة:</label>
                        <select id="category-filter">
                            <option value="all" data-key="filterAllCategories">جميع الفئات</option>
                        </select>
                    </div>
                    <div class="filter-group">
                         <label for="platform-filter" data-key="filterPlatformLabel">المنصة:</label>
                         <select id="platform-filter">
                            <option value="all" data-key="filterAllPlatforms">جميع المنصات</option>
                        </select>
                    </div>
                    <div class="sort-group">
                        <label for="sort-select" data-key="sortLabel">فرز حسب:</label>
                        <select id="sort-select">
                            <option value="default" data-key="sortDefault">الافتراضي</option>
                            <option value="newest" data-key="sortNewest">الأحدث</option>
                            <option value="popularity" data-key="sortPopularity">الأكثر شعبية</option>
                        </select>
                    </div>
                </section>

                <section class="games-grid-section">
                    <h2 data-key="allGamesTitle">جميع الألعاب</h2>
                    <div class="games-grid" id="games-grid-container">
                        <p id="loading-indicator" data-key="loadingGames" class="loading">جاري تحميل الألعاب...</p>
                    </div>
                    <div class="load-more-container">
                         <button id="load-more-btn" class="load-more-btn hidden" data-key-text="loadMoreBtn"><span>تحميل المزيد</span></button>
                    </div>
                </section>

            </div>
        </div>

        <div id="timer-view" style="display: none;">
            <div class="download-container">
                <button class="close-timer-btn" data-key-title="closeButtonTitle" title="إغلاق" aria-label="Close Download Panel"><i class="fas fa-times"></i></button>
                <img id="timer-game-img" src="placeholder-game-thumb.jpg" alt="Game Thumbnail" data-key-alt="timerGameAlt" class="timer-game-thumbnail">
                <h1 id="timer-game-title" class="timer-game-title">اسم اللعبة</h1>
                <p id="timer-game-desc" class="timer-game-description">وصف اللعبة سيظهر هنا...</p>
                <div class="timer-container">
                    <p class="timer-text" data-key="timerText">سيبدأ التحميل خلال:</p>
                    <div id="timer-display" class="timer-display">10</div>
                </div>
                <p id="status-message" class="status-message" data-key="statusPreparing">جاري تحضير الرابط...</p>
                <p class="download-notice">
                </p>
            </div>
            <a id="real-download-link" href="#" download></a>
        </div>

    </main>

    <footer class="main-footer">
        <div class="footer-content">
            <p data-key="footerRights">جميع الحقوق محفوظة &copy; <span id="year">{year}</span> مركز الألعاب</p>
            <p>
                <a href="#" data-key="privacyPolicy">سياسة الخصوصية</a> |
                <a href="#" data-key="termsOfUse">شروط الاستخدام</a> |
                <a href="#" data-key="contactUs">اتصل بنا</a>
            </p>
             <p style="font-size: 0.8em; margin-top: 15px;" data-key="legalDisclaimer">تنويه: تأكد من أن لديك التراخيص اللازمة لتوزيع الألعاب المدرجة.</p>
        </div>
    </footer>

    <script>
    const translations = {
        'ar': {
            'siteTitle': 'مركز الألعاب - تحميل أحدث الألعاب', 'siteDescription': 'اكتشف وحمل أحدث وأفضل الألعاب للكمبيوتر والموبايل. تحميلات آمنة ومباشرة.',
            'siteLogo': '<i class="fas fa-gamepad"></i> مركز الألعاب', 'searchPlaceholder': 'ابحث عن لعبة...',
            'featuredTitle': 'ألعاب مميزة هذا الأسبوع', 'featuredDesc': 'اكتشف أحدث الإضافات وأكثر الألعاب شعبية التي ننصحك بتجربتها الآن. تحميلات سريعة وموثوقة.',
            'allGamesTitle': 'جميع الألعاب', 'downloadNow': 'تحميل الآن',
            'filterCategoryLabel': 'الفئة:', 'filterAllCategories': 'جميع الفئات', 'filterPlatformLabel': 'المنصة:', 'filterAllPlatforms': 'جميع المنصات',
            'sortLabel': 'فرز حسب:', 'sortDefault': 'الافتراضي', 'sortNewest': 'الأحدث', 'sortPopularity': 'الأكثر شعبية',
            'loadingGames': 'جاري تحميل الألعاب...', 'loadMoreBtn': 'تحميل المزيد', 'errorLoadingGames': 'فشل تحميل بيانات الألعاب.', 'noGamesFound': 'لم يتم العثور على ألعاب تطابق معايير البحث.',
            'tagAction': 'أكشن', 'tagAdventure': 'مغامرات', 'tagStrategy': 'استراتيجية', 'tagPuzzle': 'ألغاز', 'tagBuilding': 'بناء', 'tagSpace': 'فضاء', 'tagLogic': 'منطق', 'categoryAction': 'أكشن', 'categoryAdventure': 'مغامرات', 'categoryStrategy': 'استراتيجية', 'categoryPuzzle': 'ألغاز',
            'platformPc': 'PC', 'platformAndroid': 'Android', 'platformIos': 'iOS',
            'gameImageAlt': 'غلاف لعبة {gameName}',
            'timerPageTitle': 'جاري تحضير التحميل...', 'timerGameAlt': 'صورة مصغرة للعبة', 'timerText': 'سيبدأ التحميل خلال:',
            'statusPreparing': 'جاري تحضير الرابط...', 'statusCountdown': 'سيتم تحويلك للتحميل خلال {timeLeft} ثانية...', 'statusStarting': 'بدء التحميل...',
            'statusErrorNoLink': 'خطأ: رابط التحميل غير متوفر!', 'statusErrorNoStart': 'خطأ: لا يمكن بدء التحميل بدون رابط صالح.',
            'downloadNotice': 'إذا لم يبدأ التحميل تلقائيًا، <a id="manual-download-link" href="{url}" style="color: var(--primary-blue);" data-key-link="manualDownloadLinkInner">انقر هنا</a>.<br><small>(تأكد من تعطيل مانع الإعلانات إذا واجهت مشكلة)</small>',
            'manualDownloadLinkInner': 'انقر هنا',
            'manualDownloadLinkAfter': 'إذا لم يبدأ التحميل، <a href="{url}" style="color: var(--primary-blue);" data-key-link="manualDownloadLinkAfterInner">حاول النقر هنا مرة أخرى</a>.',
            'manualDownloadLinkAfterInner': 'حاول النقر هنا مرة أخرى',
            'closeButtonTitle': 'إغلاق',
            'footerRights': 'جميع الحقوق محفوظة © {year} مركز الألعاب', 'privacyPolicy': 'سياسة الخصوصية', 'termsOfUse': 'شروط الاستخدام', 'contactUs': 'اتصل بنا',
            'legalDisclaimer': 'تنويه: تأكد من أن لديك التراخيص اللازمة لتوزيع الألعاب المدرجة.',
            'alertLinkMissing': 'عذراً، رابط التحميل غير محدد لهذه اللعبة.',
        },
        'en': {
             'siteTitle': 'Game Hub - Download Latest Games', 'siteDescription': 'Discover and download the latest and best games for PC and mobile. Safe and direct downloads.',
             'siteLogo': '<i class="fas fa-gamepad"></i> Game Hub', 'searchPlaceholder': 'Search for a game...',
             'featuredTitle': 'Featured Games This Week', 'featuredDesc': 'Discover the latest additions and most popular games we recommend you try now. Fast and reliable downloads.',
             'allGamesTitle': 'All Games', 'downloadNow': 'Download Now',
             'filterCategoryLabel': 'Category:', 'filterAllCategories': 'All Categories', 'filterPlatformLabel': 'Platform:', 'filterAllPlatforms': 'All Platforms',
             'sortLabel': 'Sort by:', 'sortDefault': 'Default', 'sortNewest': 'Newest', 'sortPopularity': 'Most Popular',
             'loadingGames': 'Loading games...', 'loadMoreBtn': 'Load More', 'errorLoadingGames': 'Failed to load games data.', 'noGamesFound': 'No games found matching your criteria.',
             'tagAction': 'Action', 'tagAdventure': 'Adventure', 'tagStrategy': 'Strategy', 'tagPuzzle': 'Puzzle', 'tagBuilding': 'Building', 'tagSpace': 'Space', 'tagLogic': 'Logic', 'categoryAction': 'Action', 'categoryAdventure': 'Adventure', 'categoryStrategy': 'Strategy', 'categoryPuzzle': 'Puzzle',
             'platformPc': 'PC', 'platformAndroid': 'Android', 'platformIos': 'iOS',
             'gameImageAlt': '{gameName} Cover',
             'timerPageTitle': 'Preparing Download...', 'timerGameAlt': 'Game Thumbnail', 'timerText': 'Your download will begin in:',
             'statusPreparing': 'Preparing link...', 'statusCountdown': 'Redirecting to download in {timeLeft} seconds...', 'statusStarting': 'Starting download...',
             'statusErrorNoLink': 'Error: Download link is not available!', 'statusErrorNoStart': 'Error: Cannot start download without a valid link.',
             'downloadNotice': 'If the download doesn\'t start automatically, <a id="manual-download-link" href="{url}" style="color: var(--primary-blue);" data-key-link="manualDownloadLinkInner">click here</a>.<br><small>(Make sure to disable ad-blockers if you encounter issues)</small>',
             'manualDownloadLinkInner': 'click here',
             'manualDownloadLinkAfter': 'If download doesn\'t start, <a href="{url}" style="color: var(--primary-blue);" data-key-link="manualDownloadLinkAfterInner">try clicking here again</a>.',
             'manualDownloadLinkAfterInner': 'try clicking here again',
             'closeButtonTitle': 'Close',
             'footerRights': 'All rights reserved © {year} Game Hub', 'privacyPolicy': 'Privacy Policy', 'termsOfUse': 'Terms of Use', 'contactUs': 'Contact Us',
             'legalDisclaimer': 'Notice: Ensure you have the necessary licenses to distribute the listed games.',
             'alertLinkMissing': 'Sorry, the download link for this game is not specified.',
        }
    };

    let currentLanguage = 'ar';
    let allGames = [];
    let filteredGames = [];
    let itemsPerPage = 6;
    let itemsDisplayed = 0;
    let currentSort = 'default';
    let currentCategoryFilter = 'all';
    let currentPlatformFilter = 'all';
    let currentSearchTerm = '';
    let countdownInterval = null;
    let searchDebounceTimer = null;

    const mainView = document.getElementById('main-view');
    const timerView = document.getElementById('timer-view');
    const closeTimerButton = timerView.querySelector('.close-timer-btn');
    const timerGameImg = document.getElementById('timer-game-img');
    const timerGameTitle = document.getElementById('timer-game-title');
    const timerGameDesc = document.getElementById('timer-game-desc');
    const timerDisplay = document.getElementById('timer-display');
    const statusMessage = document.getElementById('status-message');
    const realDownloadLink = document.getElementById('real-download-link');
    const downloadNoticeContainer = timerView.querySelector('.download-notice');
    const gamesGrid = document.getElementById('games-grid-container');
    const loadingIndicator = document.getElementById('loading-indicator');
    const loadMoreBtn = document.getElementById('load-more-btn');
    const categoryFilterSelect = document.getElementById('category-filter');
    const platformFilterSelect = document.getElementById('platform-filter');
    const sortSelect = document.getElementById('sort-select');
    const searchInput = document.getElementById('search-input');
    const langBtnAr = document.getElementById('lang-ar');
    const langBtnEn = document.getElementById('lang-en');
    const langButtons = [langBtnAr, langBtnEn];

    const platformIcons = { pc: '<i class="fab fa-windows" title="PC"></i>', android: '<i class="fab fa-android" title="Android"></i>', ios: '<i class="fab fa-apple" title="iOS"></i>', };
    const tagTranslations = { 'ar': {'action': 'أكشن', 'adventure': 'مغامرات', 'strategy': 'استراتيجية', 'puzzle': 'ألغاز', 'building': 'بناء', 'space': 'فضاء', 'logic': 'منطق'}, 'en': {'action': 'Action', 'adventure': 'Adventure', 'strategy': 'Strategy', 'puzzle': 'Puzzle', 'building': 'Building', 'space': 'Space', 'logic': 'Logic'} };
    const categoryTranslations = { 'ar': {'action': 'أكشن', 'adventure': 'مغامرات', 'strategy': 'استراتيجية', 'puzzle': 'ألغاز'}, 'en': {'action': 'Action', 'adventure': 'Adventure', 'strategy': 'Strategy', 'puzzle': 'Puzzle'} };
    const platformTranslations = { 'ar': {'pc': 'PC', 'android': 'Android', 'ios': 'iOS'}, 'en': {'pc': 'PC', 'android': 'Android', 'ios': 'iOS'} };

    function translateElement(el) {
        const key = el.dataset.key;
        const translation = translations[currentLanguage][key];
        if (translation !== undefined) {
            if (el.tagName === 'INPUT' && (el.type === 'search' || el.type === 'text')) { el.placeholder = translation; }
             else if (['siteLogo'].includes(key)) { el.innerHTML = translation; }
             else { el.textContent = translation; }
        } else { console.warn(`Missing static translation key: ${key} for lang: ${currentLanguage}`); }

        if (el.dataset.keyTitle) {
            const titleKey = el.dataset.keyTitle;
            if (translations[currentLanguage][titleKey] !== undefined) el.title = translations[currentLanguage][titleKey];
        }
        if (el.tagName === 'BUTTON' && el.dataset.keyText) {
            const textKey = el.dataset.keyText;
            const span = el.querySelector('span');
            const btnTranslation = translations[currentLanguage][textKey];
            if (btnTranslation !== undefined) {
                if(span) span.textContent = btnTranslation;
                 else el.textContent = btnTranslation;
            } else { console.warn(`Missing button text key: ${textKey} for lang: ${currentLanguage}`); }
        }
         if (el.tagName === 'A' && el.dataset.keyText) {
            const textKey = el.dataset.keyText;
            const linkTranslation = translations[currentLanguage][textKey];
            if (linkTranslation !== undefined) el.textContent = linkTranslation;
             else { console.warn(`Missing link text key: ${textKey} for lang: ${currentLanguage}`); }
        }
          if (el.tagName === 'OPTION' && el.dataset.key) {
             const optKey = el.dataset.key;
             if (translations[currentLanguage][optKey]) { el.textContent = translations[currentLanguage][optKey]; }
              else if(el.value !== 'all'){
                 const type = el.parentElement.id === 'category-filter' ? 'category' : 'platform';
                 const transMap = type === 'category' ? categoryTranslations : platformTranslations;
                 if(transMap[currentLanguage]?.[el.value]){ el.textContent = transMap[currentLanguage][el.value]; }
              }
         }
          if (el.tagName === 'IMG' && el.dataset.keyAlt && !el.closest('.game-card')) { // Only static images
             const altKey = el.dataset.keyAlt;
             if (translations[currentLanguage][altKey] !== undefined) el.alt = translations[currentLanguage][altKey];
         }
    }


    function translatePage(lang) {
        if (!translations[lang]) { lang = 'ar'; }
        currentLanguage = lang;
        localStorage.setItem('preferredLang', lang);
        const dir = (lang === 'ar') ? 'rtl' : 'ltr';
        document.documentElement.lang = lang;
        document.documentElement.dir = dir;
        document.body.style.direction = dir;

        langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === lang));

        document.querySelectorAll('[data-key], [data-key-text], [data-key-title], [data-key-alt], option[data-key]').forEach(translateElement);

        if(translations[lang]['siteTitle']) document.title = translations[lang]['siteTitle'];
        const metaDesc = document.querySelector('meta[name="description"]');
        if(metaDesc && translations[lang]['siteDescription']) metaDesc.content = translations[lang]['siteDescription'];

        const year = new Date().getFullYear();
        const footerRightsP = document.querySelector('p[data-key="footerRights"]');
        if(footerRightsP && translations[lang]['footerRights']) {
             footerRightsP.textContent = translations[lang]['footerRights'].replace('{year}', year);
        }

         if (allGames.length > 0) { renderGames(true); }
    }

    function detectLanguage() {
        const savedLang = localStorage.getItem('preferredLang');
        if (savedLang && translations[savedLang]) { return savedLang; }
        const preferredLanguages = navigator.languages || [navigator.language || navigator.userLanguage];
        for (let lang of preferredLanguages) { const langCode = lang.split('-')[0]; if (translations[langCode]) { return langCode; } }
        return 'ar';
    }

    function populateFilters(games) {
        const categories = new Set();
        const platforms = new Set();
        games.forEach(game => {
            if (game.category) categories.add(game.category.toLowerCase());
            if (game.platforms) game.platforms.forEach(p => platforms.add(p.toLowerCase()));
        });

        categoryFilterSelect.innerHTML = `<option value="all" data-key="filterAllCategories">${translations[currentLanguage]['filterAllCategories']}</option>`;
        categories.forEach(category => {
            const option = document.createElement('option'); option.value = category;
            const translatedCategory = categoryTranslations[currentLanguage]?.[category] || category;
            option.textContent = translatedCategory; categoryFilterSelect.appendChild(option);
        });

        platformFilterSelect.innerHTML = `<option value="all" data-key="filterAllPlatforms">${translations[currentLanguage]['filterAllPlatforms']}</option>`;
        platforms.forEach(platform => {
             const option = document.createElement('option'); option.value = platform;
             const translatedPlatform = platformTranslations[currentLanguage]?.[platform] || platform;
             option.textContent = translatedPlatform; platformFilterSelect.appendChild(option);
        });
    }

    function applyFiltersAndSort() {
         filteredGames = allGames.filter(game => {
            const categoryMatch = currentCategoryFilter === 'all' || game.category?.toLowerCase() === currentCategoryFilter;
            const platformMatch = currentPlatformFilter === 'all' || game.platforms?.map(p=>p.toLowerCase()).includes(currentPlatformFilter);
            const title = game.title[currentLanguage] || game.title['en'] || '';
            const description = game.description[currentLanguage] || game.description['en'] || '';
            const searchMatch = currentSearchTerm === '' || title.toLowerCase().includes(currentSearchTerm) || description.toLowerCase().includes(currentSearchTerm);
            return categoryMatch && platformMatch && searchMatch;
        });
        switch (currentSort) {
            case 'newest': filteredGames.sort((a, b) => new Date(b.releaseDate || 0) - new Date(a.releaseDate || 0)); break;
            case 'popularity': filteredGames.sort((a, b) => (b.popularityScore || 0) - (a.popularityScore || 0)); break;
            case 'default': filteredGames.sort((a, b) => (a.title[currentLanguage] || a.title['en']).localeCompare(b.title[currentLanguage] || b.title['en'], currentLanguage)); break;
        }
    }

    function renderGames(isRerender = false) {
        if (!isRerender) { applyFiltersAndSort(); }
        loadingIndicator.style.display = 'none';
        const gamesToShow = filteredGames.slice(0, itemsDisplayed);
        gamesGrid.innerHTML = '';

        if (gamesToShow.length === 0 ) {
             gamesGrid.innerHTML = `<p style="color: var(--text-secondary); text-align: center;" data-key="noGamesFound">${translations[currentLanguage]['noGamesFound'] || 'No games found.'}</p>`;
             loadMoreBtn.classList.add('hidden');
             return;
        }

        gamesToShow.forEach(game => {
            const gameCard = document.createElement('article'); gameCard.className = 'game-card';
            const title = game.title[currentLanguage] || game.title['en'];
            const description = game.description[currentLanguage] || game.description['en'];
            const altTextKey = `${game.id}Alt`;
            const altText = (game.altText?.[currentLanguage] || game.altText?.['en'] || translations[currentLanguage]['gameImageAlt'] || '{gameName} Cover').replace('{gameName}', title);

            const tagsHTML = (game.tags || []).map(tag => {
                const tagKey = `tag${tag.charAt(0).toUpperCase() + tag.slice(1).toLowerCase()}`;
                const translatedTag = tagTranslations[currentLanguage]?.[tag.toLowerCase()] || tag;
                return `<span data-key="${tagKey}">${translatedTag}</span>`;
            }).join(' ');
            const platformHTML = (game.platforms || []).map(p => platformIcons[p.toLowerCase()] || '').join(' ');

            gameCard.innerHTML = `
                <div class="game-thumbnail"> <img src="${game.image}" alt="${altText}" data-key-alt="${altTextKey}" loading="lazy"> </div>
                <div class="game-info">
                    <div> <h3>${title}</h3> <p>${description}</p> <div class="game-meta"> <div class="game-tags">${tagsHTML}</div> <div class="platform-icons">${platformHTML}</div> </div> </div>
                    <button class="download-button" data-key-text="downloadNow" data-title="${title}" data-desc="${description}" data-img="${game.image}" data-url="${game.downloadUrl}" data-id="${game.id}">
                        <i class="fas fa-download"></i> <span>${translations[currentLanguage]['downloadNow']}</span>
                    </button>
                </div>`;
            gamesGrid.appendChild(gameCard);
        });

        if (itemsDisplayed >= filteredGames.length) { loadMoreBtn.classList.add('hidden'); }
        else {
             loadMoreBtn.classList.remove('hidden');
             const loadMoreSpan = loadMoreBtn.querySelector('span');
             const key = loadMoreBtn.dataset.keyText;
             if(loadMoreSpan && key && translations[currentLanguage][key]) loadMoreSpan.textContent = translations[currentLanguage][key];
             else if (key && translations[currentLanguage][key]) loadMoreBtn.textContent = translations[currentLanguage][key]; // Fallback if no span
        }
        setupDownloadButtonListeners();
    }

    async function loadGames() {
        loadingIndicator.style.display = 'block'; gamesGrid.innerHTML = ''; loadMoreBtn.classList.add('hidden');
        try {
            const response = await fetch('games.json?v=' + Date.now());
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            allGames = await response.json();
            filteredGames = [...allGames]; itemsDisplayed = itemsPerPage;
            populateFilters(allGames); renderGames();
        } catch (error) {
            console.error("Could not load games data:", error); loadingIndicator.style.display = 'none';
             gamesGrid.innerHTML = `<p style="color: var(--danger-color); text-align: center;" data-key="errorLoadingGames">${translations[currentLanguage]['errorLoadingGames'] || 'Failed to load games.'}</p>`;
             loadMoreBtn.classList.add('hidden');
        }
    }

     function showTimerView(gameData) {
         timerGameTitle.textContent = gameData.title || 'Game';
         timerGameDesc.textContent = gameData.desc || '';
         timerGameImg.src = gameData.img || 'placeholder-game-thumb.jpg';
         const altKey = `${gameData.id}Alt`;
         timerGameImg.alt = (translations[currentLanguage][altKey] || translations[currentLanguage]['timerGameAlt'] || 'Image of {gameName}').replace('{gameName}', gameData.title || 'Game');
         document.title = `${translations[currentLanguage]['timerPageTitle'] || 'Preparing Download...'} - ${gameData.title || ''}`;

         if (gameData.url && !gameData.url.startsWith('REPLACE_WITH') && gameData.url !== '#') {
             realDownloadLink.href = gameData.url;
             realDownloadLink.setAttribute('download', (gameData.title || 'game') + '.zip');
             downloadNoticeContainer.innerHTML = (translations[currentLanguage]['downloadNotice'] || '').replace('{url}', gameData.url);
             const innerLink = downloadNoticeContainer.querySelector('a[data-key-link]');
              if(innerLink) { const key = innerLink.dataset.keyLink; if(translations[currentLanguage][key]) innerLink.textContent = translations[currentLanguage][key]; }
             statusMessage.textContent = translations[currentLanguage]['statusPreparing'] || 'Preparing link...';
             statusMessage.style.color = 'var(--action-blue)';
             startCountdown(10, gameData.url, gameData);
         } else {
             timerDisplay.textContent = 'X';
             statusMessage.textContent = translations[currentLanguage]['statusErrorNoLink'] || 'Error: Download link unavailable!';
             statusMessage.style.color = 'var(--danger-color)';
             downloadNoticeContainer.innerHTML = translations[currentLanguage]['statusErrorNoLink'] || 'Error: Download link unavailable!';
              if(countdownInterval) clearInterval(countdownInterval);
         }
         mainView.style.display = 'none';
         timerView.style.display = 'none'; // Keep hidden initially
         timerView.style.opacity = '0'; // Ensure opacity is 0
         // Force reflow before adding class
         void timerView.offsetWidth;
         timerView.style.display = 'flex';
         timerView.classList.add('visible'); // Add class to trigger transition
     }

    function hideTimerView() {
        if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
        timerView.classList.remove('visible');
        setTimeout(() => { timerView.style.display = 'none'; mainView.style.display = 'block'; document.title = translations[currentLanguage]['siteTitle'] || 'Game Hub'; }, 500);
    }
    function startCountdown(duration, downloadUrl, gameData) {
         let timeLeft = duration;
         function updateTimerDisplay() {
             timerDisplay.textContent = timeLeft;
             if (timeLeft <= 0) { clearInterval(countdownInterval); countdownInterval = null; triggerDownload(downloadUrl, gameData); }
              else { statusMessage.textContent = (translations[currentLanguage]['statusCountdown'] || 'Redirecting in {timeLeft} seconds...').replace('{timeLeft}', timeLeft); timeLeft--; }
         }
         if (countdownInterval) clearInterval(countdownInterval);
         updateTimerDisplay();
         countdownInterval = setInterval(updateTimerDisplay, 1000);
     }
    function triggerDownload(url, gameData) {
         if (url) {
             statusMessage.textContent = translations[currentLanguage]['statusStarting'] || 'Starting download...';
             realDownloadLink.click();
             downloadNoticeContainer.innerHTML = (translations[currentLanguage]['manualDownloadLinkAfter'] || 'If download doesnt start, <a href="{url}">click here</a>.').replace('{url}', url);
             const innerLink = downloadNoticeContainer.querySelector('a');
             if(innerLink) {
                  innerLink.style.color = 'var(--primary-blue)';
                  const innerLinkKey = 'manualDownloadLinkAfterInner';
                  if (translations[currentLanguage][innerLinkKey]) { innerLink.textContent = translations[currentLanguage][innerLinkKey]; }
             }
         } else { statusMessage.textContent = translations[currentLanguage]['statusErrorNoStart'] || 'Error: Cannot start download.'; statusMessage.style.color = 'var(--danger-color)'; }
     }

    function setupDownloadButtonListeners() {
         document.querySelectorAll('.games-grid .download-button').forEach(button => {
             const newButton = button.cloneNode(true);
             button.parentNode.replaceChild(newButton, button);
             newButton.addEventListener('click', () => {
                 const gameData = { title: newButton.dataset.title, desc: newButton.dataset.desc, img: newButton.dataset.img, url: newButton.dataset.url, id: newButton.dataset.id };
                  if (!gameData.url || gameData.url.startsWith('REPLACE_WITH') || gameData.url === '#') { alert(translations[currentLanguage]['alertLinkMissing'] || 'Link missing!'); return; }
                 showTimerView(gameData);
             });
         });
    }

    function setupEventListeners() {
        categoryFilterSelect.addEventListener('change', (e) => { currentCategoryFilter = e.target.value; itemsDisplayed = itemsPerPage; renderGames(); });
        platformFilterSelect.addEventListener('change', (e) => { currentPlatformFilter = e.target.value; itemsDisplayed = itemsPerPage; renderGames(); });
        sortSelect.addEventListener('change', (e) => { currentSort = e.target.value; itemsDisplayed = itemsPerPage; renderGames(); });
        searchInput.addEventListener('input', (e) => { clearTimeout(searchDebounceTimer); searchDebounceTimer = setTimeout(() => { currentSearchTerm = e.target.value.toLowerCase().trim(); itemsDisplayed = itemsPerPage; renderGames(); }, 300); });
        loadMoreBtn.addEventListener('click', () => { itemsDisplayed += itemsPerPage; renderGames(); });
        langButtons.forEach(btn => { btn.addEventListener('click', () => { const lang = btn.dataset.lang; if (lang !== currentLanguage) { translatePage(lang); } }); });
        if(closeTimerButton) { closeTimerButton.addEventListener('click', hideTimerView); }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const detectedLang = detectLanguage();
        currentLanguage = detectedLang;
        translatePage(detectedLang);
        loadGames();
        setupEventListeners();
    });

    </script>

</body>
</html>
